

#ifndef AD5065_H
#define AD5065_H

#define UPDATE_BOTH_DAC_COMMAND 66060288 //66060288 = 001111110000000000000000 write and update both DACs

void setDacVoltage(float voltage);
void setupDACVoltage();

void setupDACVoltage() {
	print("Set DAC voltage level:\n");

	const int size = 32;
	char buff[size];
	input(buff, size);

	float Vmax = 2.5;
	float in = atof(buff);
	if (in > Vmax || in < 0) {
		printf("Incorrect input value: %f\n", in);
		print("The value must be between 0 and 2.5\n");
	} else	{
		printf("The DAC voltage is ~ %f\n", in);
	}

	float ratio = in / Vmax;
	int val = (int)(65535*ratio);

	// Multiply the value by 16 in order to compensate for the 4 LSB zeros
	Xil_Out32(XPAR_AD5065_DUAL_DAC_AXI_0_BASEADDR, UPDATE_BOTH_DAC_COMMAND + 16*val);

}

#endif
